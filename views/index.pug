extends layouts/main.pug

block stylehead
	link(rel='stylesheet' href='/bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.css')
	link(rel='stylesheet' href='/styles/smt-bootstrap.css')

	style().

		.panel > .panel-heading {
			background-color: rgb(23,30,38);
			color : white;
		}

		.pagination > li.active > a {
			background-color: #22be34 !important;
			border-color: #22be34 !important;
		}

		div.bootstrap-tagsinput {
			float:right; 
			width: 100%;
		}

		.pagination > li > a:hover {
			cursor: pointer; 
			cursor: hand;
		}

		.not-displayed {
			display : none;
		}

		.btn-in-table {
			margin-right: 1px;
			margin-left: 1px;
		}

		* {
			font-family: "Times New Roman", Georgia, Serif;
		}

		footer{
			background: rgb(23,30,38);
			padding: 60px 20px;
		}
		
		footer ul, footer p{
			margin-bottom: 0;
		}
		
		footer .footer-block{
			margin-bottom: 30px;
		}
		
		footer a{
			color: #188b87;
		}
		
		footer .footer-menu a{
			text-transform: uppercase;
		}
		
		footer .social-icon a{
			display: block;
			width: 40px;
			height: 40px;
			line-height: 40px;
			text-align: center;
			border:1px solid #ddd;
		}
		
		@media (max-width: 767px){
			footer .footer-menu{
				text-align: center;
			}
			footer .social-icon{
				float: none !important;
				text-align: center;
			}
		}

		p.copyright {
			color: white;
		}

		.panel {
			border-color: black;
		}

		.nav-tabs {
			border-color: black;
		}

		.penjelasan {
			font-size: 16px;
		}


block content
	div(class='jumbotron' style="background-color:rgb(23,30,38);")
		div(class='container' style='padding-top:50px;')
			div(class='row')
				div(class='col-md-12 text-center')
					h1(style="color: white; font-size: 120px;") Berargumen
					br()
					p(style="color: white; font-size: 25px;") &nbsp;Visualisasi argumen dengan diagram argumen
	
	div(class='container' style='min-height: 1000px;')
		div(class='row')
			div(class='col-md-12')
				div(class='row')
					div(class='col-md-12 text-center')
						h2 Kenapa Memakai <strong>Berargumen</strong> ?
					
					div(class='col-md-12')
						div(class='row')
							div(class='col-md-6' style='margin-top: 5%;')
								p(class='penjelasan') Dengan <strong>Berargumen</strong>, anda bisa mengundang teman anda untuk berkolaborasi secara real-time, membuat suatu argumen yang baik, dan anda bisa mengundang lawan anda untuk memberikan argumen argumen yang berlawanan dengan anda, sehingga kita bisa melihat suatu topik dari kedua sisi.
							div(class='col-md-6 text-center' style='margin-top: 5%;')
								<span style="font-size:10em;" class="glyphicon glyphicon-user"></span>
								<span style="font-size:10em;" class="glyphicon glyphicon-comment"></span>
					
					div(class='col-md-12')
						div(class='row')
							div(class='col-md-6' style='margin-top: 5%;')
								p(class='penjelasan') Sebuah argumen terdiri dari beberapa bagian, seperti kesimpulan (Contention), alasan (Reason), dan lain sebagainya, dengan <strong>Berargumen</strong>, maka seseorang akan bisa mengerti bagian bagian tersebut dengan lebih mudah, sehingga alur argumen anda juga lebih mudah dimengerti, lain halnya jika anda menyampaikan sebuah argumen hanya dengan tulisan, dimana seseorang perlu menganalisa tulisan anda tersebut untuk mengetahui bagian bagian argumen dan alur dari argumen anda, dan tidak semua orang dengan mudah bisa melakukan hal ini, sehingga dengan <strong>Berargumen</strong> pembaca juga semakin banyak karena semua orang bisa mengerti sebuah argumen dengan mudah.
							div(class='col-md-6 text-center' style='margin-top: 5%;')
								<span style="font-size:10em;" class="glyphicon glyphicon-eye-open"></span>
								<span style="font-size:10em;" class="glyphicon glyphicon-ok-circle"></span>

					div(class='col-md-12')
						div(class='row')
							div(class='col-md-6' style='margin-top: 5%;')
								p(class='penjelasan') Dalam forum forum internet sering dijumpai suatu perdebatan dengan topik yang terus diulang-ulang, sering juga ditemui suatu perdebatan tiada henti (debat kusir) yang tiada titik temu, hal ini karena pada forum forum tersebut, argumennya disajikan secara tidak teratur, tidak jelas seseorang mendukung bagian argumen mana ?, atau membantah yang bagian mana ?, hal ini menimbulkan kesalahfahaman. Dengan <strong>Berargumen</strong>, sesorang bisa dengan jelas memberikan argumennya untuk mendukung bagian mana atau membantah suatu bagian argumen mana, sehingga tidak perlu ada yang diulang-ulang.
							div(class='col-md-6 text-center' style='margin-top: 5%;')
								<span style="font-size:10em;" class="glyphicon glyphicon-fire"></span>
								<span style="font-size:10em;" class="glyphicon glyphicon-ban-circle"></span>

			div(class='col-md-12' style="margin-top: 10%;")
				div(class='panel panel-default')
					div(class='panel-heading')
						p(style='font-size: 23px;') <strong>Board</strong>
					div(class='panel-body' style='min-height: 550px;')
						div(id="exTab2")
							ul(class="nav nav-tabs")
								li(class="active")
									a(href="#1" data-toggle="tab") Semua
								
								li()
									a(href="#2" data-toggle="tab") Board Saya
								
								li()
									a(href="#3" data-toggle="tab") Ditandai

								li()
									a(href="#4" data-toggle="tab") Board Kolaborasi
							
							div(class="tab-content")
								div(class="tab-pane active" id="1")
									div(class='row')
										div(class='col-md-12')
											div(class='row')
												div(class='col-md-6')
												div(class='col-md-6')
													br()
													input(class='form-control input-sm' placeholder='Cari berdasar judul, deskripsi, tag')

										div(class='col-md-12')
											br()
											table(class='table table-default table-striped table-bordered')
												thead()
													tr()
														th(class='text-center' width='15%') Judul
														th(class='text-center' width='35%') Deskripsi
														th(class='text-center' width='10%') Pemilik
														th(class='text-center' width='20%') Tags
														th(class='text-center' width='10%') Diperbaharui
														th(class='text-center' width='10%') 
												tbody(v-if="boards.all.length")
													tr(v-for="board in boards.all")
														td() {{ board.getTitle() }}
														td() {{ board.getDescription() }}
														td()
															a(@click="viewUserProfile(board.getUser().getId())") {{ board.getUser().getName() }}
														td()
															button(class='btn btn-default btn-xs btn-in-table' v-for="tag in board.getTags()" @click="viewBoardByTag(tag)") {{ tag }}
														td(class='text-center') {{ board.getUpdatedDate() }}
														td(class='text-center')
															button(@click="viewBoard(board.getId())" class='btn btn-warning btn-xs btn-in-table') Lihat
												tbody(v-if="!boards.all.length")
													tr()
														td(class='text-center' colspan="6") Tidak Ada Board
														

											div(class='row')
												div(class='col-md-6')
													ul(class='pagination')
														li(v-for='page in numberOfPages.allBoards' v-if="!displayPaginationButton(currentPage.allBoards, page)" v-bind:class="{ 'active' : currentPage.allBoards == page }")
															a(@click="allBoardsGoToPage(page)") {{ page }}

								div(class="tab-pane" id="2")
									div(class='row')
										div(class='col-md-12')
											div(class='row')
												div(class='col-md-6')
													br()
													button(@click="openModalToCreateBoard()" class='btn btn-primary btn-sm' v-bind:disabled="currentUser == null") Buat Board
												div(class='col-md-6')
													br()
													input(class='form-control input-sm' v-bind:disabled="currentUser == null" placeholder='Cari berdasar judul, deskripsi, tag')

										div(class='col-md-12' v-if="currentUser != null")
											br()
											table(class='table table-default table-striped table-bordered')
												thead()
													tr()
														th(class='text-center') Judul
														th(class='text-center') Deskripsi
														th(class='text-center') Tags
														th(class='text-center') Diperbaharui
														th(class='text-center') 
												tbody(v-if="boards.currentUser.length")
													tr(v-for="(board, index) in boards.currentUser")
														td() {{ board.getTitle() }}
														td() {{ board.getDescription() }}
														td()
															button(class='btn btn-default btn-xs btn-in-table' v-for="tag in board.getTags()" @click="viewBoardByTag(tag)") {{ tag }}
														td(class='text-center') {{ board.getUpdatedDate() }}
														td(class='text-center')
															button(@click="viewBoard(board.getId())" class='btn btn-warning btn-xs btn-in-table') Lihat
															button(@click="openModalToEditBoard(index)" class='btn btn-success btn-xs btn-in-table') Ubah
												tbody(v-if="!boards.currentUser.length")
													tr()
														td(class='text-center' colspan="6") Tidak Ada Board Yang And Buat

											div(class='row')
												div(class='col-md-6')
													ul(class='pagination')
														li(v-for='page in numberOfPages.currentUserBoards' v-if="!displayPaginationButton(currentPage.currentUserBoards, page)" v-bind:class="{ 'active' : currentPage.currentUserBoards == page }")
															a(@click="currentUserBoardsGoToPage(page)") {{ page }}


										div(class='col-md-12 text-center' v-if="currentUser == null")
											br()
											h5() Anda harus login untuk melihat board anda
								
								div(class="tab-pane" id="3")
									div(class='row')
										div(class='col-md-12')
											div(class='row')
												div(class='col-md-6')
												div(class='col-md-6')
													br()
													input(class='form-control input-sm' v-bind:disabled="currentUser == null" placeholder='Cari berdasar judul, deskripsi, tag')

										div(class='col-md-12' v-if="currentUser != null")
											br()
											table(class='table table-default table-striped table-bordered')
												thead()
													tr()
														th(class='text-center') Judul
														th(class='text-center') Deskripsi
														th(class='text-center') Pemilik
														th(class='text-center') Tags
														th(class='text-center') Diperbaharui
														th(class='text-center') 
												tbody(v-if="boards.bookmarked.length")
													tr(v-for="board in boards.bookmarked")
														td() {{ board.getTitle() }}
														td() {{ board.getDescription() }}
														td()
															a(@click="viewUserProfile(board.getUser().getId())") {{ board.getUser().getName() }}
														td() 
															button(class='btn btn-default btn-xs btn btn-in-table' v-for="tag in board.getTags()" @click="viewBoardByTag(tag)") {{ tag }}
														td(class='text-center') {{ board.getUpdatedDate() }}
														td(class='text-center')
															button(@click="viewBoard(board.getId())" class='btn btn-warning btn-xs') Lihat
												tbody(v-if="!boards.bookmarked.length")
													tr()
														td(class='text-center' colspan="6") Tidak Ada Board Yang Anda Tandai

											div(class='row')
												div(class='col-md-6')
													ul(class='pagination')
														li(v-for='page in numberOfPages.bookmarkedBoards' v-if="!displayPaginationButton(currentPage.bookmarkedBoards, page)" v-bind:class="{ 'active' : currentPage.bookmarkedBoards == page }")
															a(@click="currentUserBoardsGoToPage(page)") {{ page }}


										div(class='col-md-12 text-center' v-if="currentUser == null")
											br()
											h5() Anda harus login untuk melihat board yang anda tandai

								div(class="tab-pane" id="4")
									div(class='row')
										div(class='col-md-12')
											div(class='row')
												div(class='col-md-6')
												div(class='col-md-6')
													br()
													input(class='form-control input-sm' v-bind:disabled="currentUser == null" placeholder='Cari berdasar judul, deskripsi, tag')

										div(class='col-md-12' v-if="currentUser != null")
											br()
											table(class='table table-default table-striped table-bordered')
												thead()
													tr()
														th(class='text-center') Judul
														th(class='text-center') Deskripsi
														th(class='text-center') Pemilik
														th(class='text-center') Tags
														th(class='text-center') Diperbaharui
														th()
												tbody(v-if="boards.collaborated.length")
													tr(v-for="board in boards.collaborated")
														td() {{ board.getTitle() }}
														td() {{ board.getDescription() }}
														td()
															a(@click="viewUserProfile(board.getUser().getId())") {{ board.getUser().getName() }}
														td() 
															button(class='btn btn-default btn-xs btn btn-in-table' v-for="tag in board.getTags()" @click="viewBoardByTag(tag)") {{ tag }}
														td(class='text-center') {{ board.getUpdatedDate() }}
														td(class='text-center')
															button(@click="viewBoard(board.getId())" class='btn btn-warning btn-xs') Lihat
												tbody(v-if="!boards.collaborated.length")
													tr()
														td(class='text-center' colspan="6") Tidak Ada Board Yang Anda Berkolaborasi

											div(class='row')
												div(class='col-md-6')
													ul(class='pagination')
														li(v-for='page in numberOfPages.collaboratedBoards' v-if="!displayPaginationButton(currentPage.collaboratedBoards, page)" v-bind:class="{ 'active' : currentPage.collaboratedBoards == page }")
															a(@click="currentUserBoardsGoToPage(page)") {{ page }}


										div(class='col-md-12 text-center' v-if="currentUser == null")
											br()
											h5() Anda harus login untuk melihat board yang anda berkolaborasi
								
						

			div(class='col-md-12')
				div(class='row')
					div(class='col-md-6')
					div(class='col-md-6')
						div(class='panel panel-default')
							div(class='panel-heading')
								p(style='font-size: 23px;') <strong>Tag Populer</strong>
							div(class='panel-body')

			div(class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="create-board-modal")
				div(class="modal-dialog modal-lg" role="document")
					div(class="modal-content")
						div(class="modal-header")
							div(class='row')
								div(class='col-md-12')
									h4(v-if="forms.createBoard.status == 'create-board'") Buat Board
									h4(v-if="forms.createBoard.status == 'edit-board'") Ubah Board
						div(class="modal-body")
							div(class="row")
								div(class="col-md-12")
									div(class="form-group")
										label() Judul
										input(v-model="forms.createBoard.title" class="form-control")
									div(class="form-group")
										label() Deskripsi
										textarea(v-model="forms.createBoard.description" class="form-control")
									div(class="form-group")
										label() Tags
										input(type="text" id="tagsinput")
										br()
										p(style="font-size:13px;") Untuk menambah tags, isikan kata lalu tekan 
											strong() Enter
									div(class="form-group" style="padding-top:5%;")
										button(v-if="forms.createBoard.status == 'create-board'" class='btn btn-primary btn-sm' @click='createBoard()') Buat
										button(v-if="forms.createBoard.status == 'edit-board'" class='btn btn-success btn-sm' @click='editBoard()') Ubah
										button(class='btn btn-warning btn-sm' @click='hideCreateBoardModal()') Tutup
	footer(style="margin-top: 30%;")
		div(class="container")
			div(class="row")
				div(class="col-sm-4")
					div(class="footer-block")
						ul(class="list-inline footer-menu")
							
						
				div(class="col-sm-4")
					div(class="footer-block text-center")
						p(class="copyright") © 2017 Berargumen.
				div(class="col-sm-4")
					div(class="footer-block")
					
block script
	script(type='text/javascript' src='/bower_components/jquery/dist/jquery.js')
	script(type='text/javascript' src='/bower_components/bootstrap/dist/js/bootstrap.js')
	script(type='text/javascript' src='/bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.js')
	script(type='text/javascript' src='/bower_components/vue/dist/vue.js')
	script(type='text/javascript' src='/bower_components/moment/moment.js')

	script(type='text/javascript' src='/models/user.js')
	script(type='text/javascript' src='/models/board.js')
	
	script(type='text/javascript').
		var app = new Vue({
			el : '#app',
			data : {
				boards : {
					currentUser : [],
					all : [],
					bookmarked : [],
					collaborated : [],
				},
				toBe : {
					boardIndexEdited : null
				},
				currentUser : null,

				modals : {
					createBoardModal : null
				},
				forms : {
					createBoard : {
						title : null,
						description : null,
						tags : null,
						status : 'create-board'
					}
				},
				inputs : {
					tags : null
				},
				numberOfPages : {
					allBoards : 0,
					currentUserBoards : 0,
					bookmarkedBoards : 0,
					collaboratedBoards : 0
				},
				currentPage : {
					allBoards : 1,
					currentUserBoards : 1,
					bookmarkedBoards : 1,
					collaboratedBoards : 1
				}
			},
			methods : {
				getCurrentUser : function() {
					
					var vm = this;
					
					var request = $.get({
						url : '/api/me',
					});

					return request
						.then(function(user) {
							
							vm.currentUser = new User();
							vm.currentUser
								.setId(user._id)
								.setName(user.name)
								.setPhotoUrl(user.profilePicUrl)

							return user;	
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				getCurrentUserBoards : function(page) {
					var vm = this;

					var request = $.get({
						url : '/api/my-boards',
						data: { 
						   page: page == null ? 1 : page, 
						},
					});

					request
						.then(function(currentUserBoards) {
							
							vm.boards.currentUser.splice(0, vm.boards.currentUser.length)

							vm.numberOfPages.currentUserBoards= currentUserBoards.pages;

							currentUserBoards.docs.forEach(function(board) {
								
								var updatedDate = moment(board.updated).format('D-MM-YYYY');
								
								var toBePushedboard  = new Board();
								
								toBePushedboard
									.setId(board._id)
									.setTitle(board.title)
									.setDescription(board.description)
									.setUpdatedDate(updatedDate)
									.setTags(board.tags);

								vm.boards.currentUser.push(toBePushedboard);
							})
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				getAllBoards : function(page) {
					var vm = this;

					var request = $.get({
						url : '/api/boards',
						data: { 
						   page: page == null ? 1 : page, 
						},
					});

					request
						.then(function(allBoards) {
							
							vm.boards.all.splice(0, vm.boards.all.length)

							vm.numberOfPages.allBoards = allBoards.pages;

							allBoards.docs.forEach(function(board) {
								var user = new User();
								
								user
									.setId(board.user.id)
									.setName(board.user.name)
								
								var updatedDate = moment(board.updated).format('D-MM-YYYY');
								var toBePushedboard  = new Board();
								
								toBePushedboard
									.setId(board._id)
									.setTitle(board.title)
									.setDescription(board.description)
									.setUser(user)
									.setUpdatedDate(updatedDate)
									.setTags(board.tags);

								vm.boards.all.push(toBePushedboard);
							})
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				editBoard : function() {
					
					var vm = this;

					var boardIdToBeEdited = this.boards.currentUser[this.toBe.boardIndexEdited].getId();
					var url = '/api/board/' + boardIdToBeEdited + '/update';

					vm.forms.createBoard.tags = vm.inputs.tags.val();

					var request = $.post({
						url : url,
						data : JSON.stringify(vm.forms.createBoard),
						contentType : 'application/json; charset=UTF-8',
					});

					return request
						.then(function() {
							vm.getCurrentUserBoards(vm.currentPage.currentUserBoards);
							vm.hideCreateBoardModal();
						})
						.catch(function(error) {
							console.log(error);
							alert('Errro Happen')
							vm.hideCreateBoardModal();
						})
				},
				getBookmarkedBoards : function(page) {
					var vm = this;

					var request = $.get({
						url : '/api/bookmarked-boards',
						data: { 
						   page: page == null ? 1 : page, 
						},
					});

					request
						.then(function(bookmarkedBoards) {
							
							vm.boards.bookmarked.splice(0, vm.boards.bookmarked.length)

							vm.numberOfPages.bookmarkedBoards= bookmarkedBoards.pages;

							bookmarkedBoards.docs.forEach(function(board) {
								var user = new User();
								
								user
									.setId(board.user.id)
									.setName(board.user.name)
								
								var updatedDate = moment(board.updated).format('D-MM-YYYY');
								
								var toBePushedboard  = new Board();
								toBePushedboard
									.setId(board._id)
									.setTitle(board.title)
									.setDescription(board.description)
									.setUser(user)
									.setUpdatedDate(updatedDate)
									.setTags(board.tags);

								vm.boards.bookmarked.push(toBePushedboard);
							})
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				getCollaboratedBoards : function(page) {
					var vm = this;

					var request = $.get({
						url : '/api/collaborated-boards',
						data: { 
						   page: page == null ? 1 : page, 
						},
					});

					request
						.then(function(collaboratedBoards) {
							
							vm.boards.collaborated.splice(0, vm.boards.collaborated.length)

							vm.numberOfPages.collaboratedBoards = collaboratedBoards.pages;

							collaboratedBoards.docs.forEach(function(board) {
								
								var user = new User();
								
								user
									.setId(board.user.id)
									.setName(board.user.name)
								
								var updatedDate = moment(board.updated).format('D-MM-YYYY');
								var toBePushedboard  = new Board();
								toBePushedboard
									.setId(board._id)
									.setTitle(board.title)
									.setDescription(board.description)
									.setUser(user)
									.setUpdatedDate(updatedDate)
									.setTags(board.tags);

								vm.boards.collaborated.push(toBePushedboard);
							})
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				openCreateBoardModal : function() {
					this.modals.createBoardModal.modal({
						backdrop: 'static',
						keyboard: false
					})
				},
				openModalToCreateBoard : function() {
					this.forms.createBoard.status = 'create-board';
					this.openCreateBoardModal();
				},
				hideCreateBoardModal : function() {
					this.modals.createBoardModal.modal('hide')
				},
				createBoard : function() {
				
					var vm = this;

					vm.forms.createBoard.tags = vm.inputs.tags.val();

					var request = $.post({
						url : '/api/board',
						data : JSON.stringify(vm.forms.createBoard),
						contentType : 'application/json; charset=UTF-8',
					});

					request
						.then(function(newBoard) {
							vm.getCurrentUserBoards(vm.currentPage.currentUserBoards);
							vm.hideCreateBoardModal();
						})
						.catch(function(error) {
							console.log(error)
						})
				},
				viewBoard : function(boardId) {
					var url = '/board/' + boardId;
					window.open(url);
				},
				currentUserBoardsGoToPage : function(page) {
					this.currentPage.currentUserBoards = page;
					this.getCurrentUserBoards(page);
				},
				allBoardsGoToPage : function(page) {
					this.currentPage.allBoards = page;
					this.getAllBoards(page);
				},
				bookmarkedBoardsGoToPage : function(page) {
					this.currentPage.bookmarkedBoards = page;
					this.getBookmarkedBoards(page);
				},
				collaboratedBoardsGoToPage : function(page) {
					this.currentPage.collaboratedBoards = page;
					this.getCollaboratedBoards(page);
				},
				displayPaginationButton : function(currentPage, page) {
					return (currentPage - 2) > page || (currentPage + 2) < page  
				},
				viewUserProfile : function(userId) {
					window.open('/profile/' + userId);
				},
				openModalToEditBoard : function(index) {
					var vm = this;
					
					vm.forms.createBoard.status = 'edit-board';
					vm.toBe.boardIndexEdited = index;
					
					vm.boards.currentUser[index].getTags().forEach(function(tag) {
						vm.inputs.tags.tagsinput('add', tag);						
					})
					vm.forms.createBoard.title = vm.boards.currentUser[index].getTitle();
					vm.forms.createBoard.description = vm.boards.currentUser[index].getDescription();

					vm.openCreateBoardModal();
				},
				viewBoardByTag : function(tag) {
					var url = '/tag/board?tag=' + tag;
					window.open(url);
				}
			},
			mounted : function() {
				var vm = this;

				vm.inputs.tags =  $('#tagsinput');
				vm.inputs.tags.tagsinput();
					
				vm.modals.createBoardModal = $('#create-board-modal');
				vm.modals.createBoardModal.on('hidden.bs.modal', function() {
					vm.forms.createBoard.title = '';
					vm.forms.createBoard.description = '';
					vm.inputs.tags.tagsinput('removeAll');
				})
				
				vm.getCurrentUser()
					.then(function(data) {
						vm.getCurrentUserBoards();
						vm.getCollaboratedBoards();
						vm.getBookmarkedBoards();
					})

				vm.getAllBoards();
			}
		})